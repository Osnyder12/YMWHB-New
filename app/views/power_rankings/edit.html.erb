<% dragActions = "dragstart->drag#dragStart dragover->drag#dragOver dragenter->drag#dragEnter drop->drag#drop dragend->drag#dragEnd" %>

<div class="w-full mx-auto md:w-2/3">
  <h1 class="text-4xl font-bold">Editing Week <%= @power_ranking.week %> Power Ranking</h1>

  <%= render "form", power_ranking: @power_ranking %>

  <%= link_to 'Add New Ranking', new_power_ranking_ranking_path(@power_ranking), class: "mb-5 rounded-lg py-3 px-5 bg-yellow-300 hover:bg-yellow-700 inline-block font-medium" %>
  <%= link_to "View Power Ranking", power_ranking_path, class: "mb-5 rounded-lg py-3 px-5 bg-blue-300 hover:bg-blue-700 inline-block font-medium" %>

  <div class="w-full mx-auto ">
    <div class="pb-2 mb-6 border-b-2">
      <h2 class="text-xl font-bold">
        Rankings
      </h2>
      <p class="text-gray-700">(drag and drop to reorder rankings)</p>
    </div>
    <ul>
        <div id="rankings">
        <% @rankings.each do |ranking| %>
            <%= content_tag(:div, class: 'bi bi-grip-vertical draggable', draggable: true, data: {
              controller: "drag",
              action: dragActions,
              resource_id: ranking.id,
              url: "/rankings/drag",
              parent: "rankings",
            }) do %>
            <div id="<%= dom_id ranking %>">
              <li class="flex mb-6 border-b border-yellow-500 h-fit">
                <div class="w-full mr-10">
                  <% if ranking.avatar.present? %>
                  <%= image_tag ranking.avatar.url,
                      class: 'object-fill mb-2' %>
                    <% end %>
                    <%= button_to "Delete", "/power_rankings/#{@power_ranking.id}/rankings/#{ranking.id}", method: :delete, class: "mb-3 bg-red-500 hover:bg-red-700 text-black-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium" %>
                    <%= link_to "Edit", edit_power_ranking_ranking_path(@power_ranking.id, ranking.id), method: :get, class: "bg-yellow-300 hover:bg-yellow-700 mb-3 text-black-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium" %>
                </div>
                <div>
                  <h2 class="mb-3 text-lg font-bold"><%= ranking.position %>: <%= ranking.team.team_name %></h2>
                  <p class="break-all">
                    <%= sanitize(ranking.description) %>
                  </p>
                </div>
              </li>
            </div>
          <% end %>
        <% end %>
      </div>
      </ul>
  </div>
</div>

